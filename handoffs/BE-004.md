# Handoff: BE-004

## 1. Metadata
1. Task ID: `BE-004`
2. Title: Implement student attempt APIs
3. Owner Agent: Backend
4. Handoff Date: 2026-02-24
5. Proposed Next State: `DONE`

## 2. Summary of Work
1. Implemented student attempt flow APIs:
1. `student-start-attempt`
2. `student-submit-response`
3. `student-complete-attempt`
2. Added shared student-domain helper module in `_shared/student.ts`.
3. Implemented core rules:
1. first/last/class identity handling
2. open-window enforcement (`all` and `allowlist`)
3. one-lifetime-attempt policy with reopen override
4. in-progress resume behavior
5. ordered question progression enforcement
6. per-response timing persistence and clamping

## 3. Files and Artifacts
1. Files changed:
1. `/Users/akashdatta/Desktop/prod-vocabpal-baseline-500/supabase/functions/_shared/student.ts`
2. `/Users/akashdatta/Desktop/prod-vocabpal-baseline-500/supabase/functions/student-start-attempt/index.ts`
3. `/Users/akashdatta/Desktop/prod-vocabpal-baseline-500/supabase/functions/student-submit-response/index.ts`
4. `/Users/akashdatta/Desktop/prod-vocabpal-baseline-500/supabase/functions/student-complete-attempt/index.ts`
2. Deploy commands:
1. `npx supabase functions deploy student-start-attempt --use-api --no-verify-jwt --project-ref efbmcxadmdarzlfxjjsd`
2. `npx supabase functions deploy student-submit-response --use-api --no-verify-jwt --project-ref efbmcxadmdarzlfxjjsd`
3. `npx supabase functions deploy student-complete-attempt --use-api --no-verify-jwt --project-ref efbmcxadmdarzlfxjjsd`

## 4. Validation Evidence
1. `student-start-attempt` returned explicit business-state error when no open window existed.
2. After creating an open window, `student-start-attempt` returned `attemptId` and first question payload.
3. Full scripted run of all 10 items completed successfully through submit and complete endpoints.

## 5. Downstream Impact
1. Unblocks UI work for student baseline flow.
2. Unblocks QA automation for API integration and E2E student path.

## 6. Open Issues
1. Teacher window-management API is not yet implemented (window for smoke test was inserted temporarily via service-role REST call).

## 7. Requested PM Action
1. Mark `BE-004` as `DONE`.
