# Handoff: BE-009

## 1. Metadata
1. Task ID: `BE-009`
2. Title: Implement teacher reopen API
3. Owner Agent: Backend
4. Handoff Date: 2026-02-24
5. Proposed Next State: `DONE`

## 2. Summary of Work
1. Added new `teacher-reopen` function to grant additional baseline attempts per student/class identity.
2. Enforced auditable reopen policy through `teacher_reopens` table writes and teacher audit events.
3. Fixed retake policy implementation gap by migrating attempts constraint:
1. removed strict one-row unique `(student_id, test_id)`
2. added partial unique index for single active in-progress attempt.

## 3. Files and Artifacts
1. Files changed:
1. `/Users/akashdatta/Desktop/prod-vocabpal-baseline-500/supabase/functions/teacher-reopen/index.ts`
2. `/Users/akashdatta/Desktop/prod-vocabpal-baseline-500/supabase/functions/teacher-reopen/deno.json`
3. `/Users/akashdatta/Desktop/prod-vocabpal-baseline-500/supabase/migrations/20260224122000_reopen_attempt_policy.sql`
2. Commands executed:
1. `npx supabase db push`
2. `npx supabase functions deploy teacher-reopen --use-api --no-verify-jwt --project-ref efbmcxadmdarzlfxjjsd`

## 4. Validation Evidence
1. QA smoke verified:
1. retake blocked before reopen (`409`)
2. reopen grant succeeds
3. second attempt allowed after reopen
2. Remote migration list confirms new migration is applied.

## 5. Downstream Impact
1. Unblocks `UI-004` reopen control in teacher dashboard.
2. Aligns implementation with locked retake policy in `master_plan.md`.

## 6. Open Issues
1. None for current scope.

## 7. Requested PM Action
1. Mark `BE-009` as `DONE`.
